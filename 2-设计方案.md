# InsightReader 详细设计方案

## 文档索引

本设计方案基于最新的产品蓝图，围绕"上下文智能探针"这一核心功能展开。

### 核心设计文档

1. **[2.1-系统架构设计.md](./2.1-系统架构设计.md)**
   - 整体系统架构
   - 技术栈详细说明
   - 模块划分与职责
   - 部署架构
   - 性能与安全考虑

2. **[2.2-数据库设计.md](./2.2-数据库设计.md)**
   - 精简的数据模型设计
   - 表结构定义
   - 索引策略
   - 数据关系图

3. **[2.3-后端API设计.md](./2.3-后端API设计.md)**
   - RESTful API 规范
   - 完整接口文档
   - 请求/响应格式
   - 错误处理
   - 认证机制（V2.0）

4. **[2.4-前端架构设计.md](./2.4-前端架构设计.md)**
   - 前端目录结构
   - 组件设计规范
   - 状态管理方案
   - 路由设计
   - 核心页面组件

5. **[2.5-AI服务设计.md](./2.5-AI服务设计.md)**
   - 上下文智能探针实现
   - Prompt 工程
   - 划词选中与意图识别
   - 洞察卡片生成
   - AI 响应优化

6. **[2.6-UI设计规范.md](./2.6-UI设计规范.md)**
   - 设计系统
   - 双栏阅读界面
   - 划词交互设计
   - 洞察卡片UI
   - 响应式设计

---

## 产品核心定位

### 最好的阅读辅助工具
- **目标用户**: 普通的文章阅读者（如知乎用户）
- **核心场景**: 阅读时遇到不懂的术语、概念、论证逻辑
- **解决方案**: 划词即问，即时获得AI生成的洞察卡片

---

## 核心功能：上下文智能探针

### 工作流程

```
┌─────────────────────────────────────────────────────────┐
│  1. 用户在阅读界面划词选中任意内容                        │
│     (可以是术语、短语、句子)                              │
└────────────────┬────────────────────────────────────────┘
                 │
                 ▼
┌─────────────────────────────────────────────────────────┐
│  2. 弹出智能预测按钮:                                     │
│     • "这是什么意思？"                                    │
│     • "作者为什么这么说？"                                │
│     • "有不同的看法吗？"                                  │
│     • 开放输入框（自定义追问）                            │
└────────────────┬────────────────────────────────────────┘
                 │
                 ▼
┌─────────────────────────────────────────────────────────┐
│  3. AI 结合选中内容 + 文章上下文生成洞察卡片:            │
│     • 核心解释（术语、背景知识）                          │
│     • 逻辑分析（论证手法）                                │
│     • 多元视角（反方观点）[V2.0]                          │
│     • 来源链接（可选）                                    │
└─────────────────────────────────────────────────────────┘
```

### 核心优势

1. **成本与延迟可控**: 只在用户需要时调用 AI，成本降低 95%
2. **用户主导**: 用户好奇心驱动，AI 是专家顾问而非自作主张的导游
3. **界面简洁**: 唯一交互点是"划词选中"，符合用户直觉
4. **精准满足需求**: 统一的"探究"动作，灵活应对各种场景

---

## 设计原则

### 1. 极简主义
- MVP 阶段不做登录系统
- 不做保存/收藏功能
- 专注核心体验：划词 → 获得洞察

### 2. 响应速度优先
- 划词后 < 100ms 显示预测按钮
- AI 响应 < 3s（流式返回）
- 界面流畅无卡顿

### 3. 用户控制权
- 不主动生成注解
- 不预处理全文
- AI 只在被召唤时工作

### 4. 渐进增强
- MVP: 核心解释 + 逻辑分析
- V2.0: 多元视角 + 追问功能
- V3.0: 收藏系统 + 知识库

---

## 技术栈总览

### 前端
- **框架**: Vue 3 + Nuxt 4
- **UI库**: Shadcn-vue
- **样式**: TailwindCSS
- **状态管理**: Pinia (V2.0 引入)
- **工具库**: VueUse

### 后端
- **框架**: Python 3.11+ + FastAPI
- **文本处理**: spaCy (句子分割)
- **数据库**: SQLite (V2.0 引入，用于保存会话)
- **异步IO**: asyncio + httpx

### AI 服务
- **LLM**: Claude 3.5 Sonnet (主力) / Haiku (简单任务)
- **搜索**: Tavily AI (V2.0 引入)

### DevOps
- **前端部署**: Vercel
- **后端部署**: Railway / Render

---

## MVP 开发优先级

### P0 (必须实现)
1. ✅ 双栏阅读界面（左侧原文，右侧洞察卡片）
2. ✅ 用户粘贴文章内容，自动句子分割
3. ✅ 划词选中 + 智能预测按钮
4. ✅ 洞察卡片生成（核心解释 + 逻辑分析）
5. ✅ 流式响应，优化等待体验

### P1 (重要但可延后)
- 外观自定义（字体、字号、夜间模式）
- 移动端适配
- 错误处理与重试

### P2 (V2.0)
- 用户登录系统
- 洞察卡片收藏（暂存区）
- 多元视角/反方观点
- 自定义追问

### P3 (V3.0)
- 智能知识库
- 知识卡片关联
- 分享功能

---

## 后续版本规划

### V2.0 - 成为"思考伙伴"
- 洞察卡片增强（多元视角 + 启发性追问）
- 用户登录系统
- "洞察暂存区"（单次阅读总结）

### V3.0 - 知识连接
- 智能知识库
- 基于卡片的知识关联
- AI 自动提示新旧卡片的联系

---

## 关键技术挑战

### 1. 划词选中的精确定位
- 需要记录选中文本在原文中的位置
- 提取上下文（前后各 2-3 句）
- 处理跨段落选中

### 2. 意图识别
- 根据选中内容类型（单词/短语/句子）推荐合适的问题按钮
- NER（命名实体识别）识别术语
- 句子结构分析识别论证

### 3. 流式响应体验
- Server-Sent Events (SSE) 实现流式输出
- 前端逐字渲染，避免闪烁
- 错误恢复机制

### 4. 成本控制
- 精准控制上下文长度
- 使用更便宜的模型处理简单任务
- 缓存常见问题的回答

---

**文档版本**: 2.0（基于最新产品蓝图）
**最后更新**: 2025-01-19
**维护者**: InsightReader 开发团队
